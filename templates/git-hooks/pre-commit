#!/bin/sh
#
# VibeSafe pre-commit hook
# Prevents commits when system files are out of sync
#
# Install: cp templates/git-hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "Running VibeSafe validation..."

# Run validation script
if ! python scripts/validate_vibesafe_structure.py --no-color 2>&1 | grep -q "Validation PASSED"; then
    echo ""
    echo "❌ Commit blocked: Validation failed"
    echo ""
    echo "Common issues:"
    echo "  - System file drift: templates/ (principal) differs from runtime copies"
    echo "  - YAML frontmatter errors"
    echo "  - Invalid cross-references"
    echo ""
    echo "Run: python scripts/validate_vibesafe_structure.py"
    echo ""
    echo "⚠️  For drift: Investigate WHY files diverged before syncing!"
    echo "   templates/ is the source of truth (propagates on install)"
    echo ""
    exit 1
fi

echo "✅ Validation passed"
exit 0

